<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Language Model Perplexities — perplexity • kgrams</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Language Model Perplexities — perplexity" />
<meta property="og:description" content="Compute language model perplexities on a test corpus." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">kgrams</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/kgrams.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Language Model Perplexities</h1>
    
    <div class="hidden name"><code>perplexity.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Compute language model perplexities on a test corpus.</p>
    </div>

    <pre class="usage"><span class='fu'>perplexity</span><span class='op'>(</span>
  <span class='va'>text</span>,
  <span class='va'>model</span>,
  .preprocess <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>model</span>, <span class='st'>".preprocess"</span><span class='op'>)</span>,
  .tknz_sent <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>model</span>, <span class='st'>".tknz_sent"</span><span class='op'>)</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='co'># S3 method for character</span>
<span class='fu'>perplexity</span><span class='op'>(</span>
  <span class='va'>text</span>,
  <span class='va'>model</span>,
  .preprocess <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>model</span>, <span class='st'>".preprocess"</span><span class='op'>)</span>,
  .tknz_sent <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>model</span>, <span class='st'>".tknz_sent"</span><span class='op'>)</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='co'># S3 method for connection</span>
<span class='fu'>perplexity</span><span class='op'>(</span>
  <span class='va'>text</span>,
  <span class='va'>model</span>,
  .preprocess <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>model</span>, <span class='st'>".preprocess"</span><span class='op'>)</span>,
  .tknz_sent <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/attr.html'>attr</a></span><span class='op'>(</span><span class='va'>model</span>, <span class='st'>".tknz_sent"</span><span class='op'>)</span>,
  batch_size <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>text</th>
      <td><p>a character vector or connection. Test corpus from which
language model perplexity is computed.</p></td>
    </tr>
    <tr>
      <th>model</th>
      <td><p>either an object of class <code>language_model</code>, or a
<code>kgram_freqs</code> object. The language model from which probabilities
are computed.</p></td>
    </tr>
    <tr>
      <th>.preprocess</th>
      <td><p>a function taking a character vector as input and
returning a character vector as output. Preprocessing transformation
applied to input before computing perplexity.</p></td>
    </tr>
    <tr>
      <th>.tknz_sent</th>
      <td><p>a function taking a character vector as input and
returning a character vector as output. Optional sentence tokenization step
applied before computing perplexity.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>further arguments passed to or from other methods.</p></td>
    </tr>
    <tr>
      <th>batch_size</th>
      <td><p>a length one positive integer or <code>NULL</code>.
Size of text batches when reading text from a <code>connection</code>.
If <code>NULL</code>, all input text is processed in a single batch.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a number. Perplexity of the language model on the test corpus.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>These generic functions are used to compute a <code>language_model</code>
perplexity on a test corpus, which may be either a plain character vector
of text, or a connection from which text can be read in batches.
The second option is useful if one wants to avoid loading
the full text in physical memory, and allows to process text from
different sources such as files, compressed files or URLs.</p>
<p>"Perplexity" is defined here, following Ref.
(Chen and Goodman 1999)
, as the exponential of the normalized
language model cross-entropy with the test corpus. Cross-entropy is
normalized by the total number of words in the corpus, where we include
the End-Of-Sentence tokens, but not the Begin-Of-Sentence tokens, in the
word count.</p>
<p>The custom .preprocess and .tknz_sent arguments allow to apply
transformations to the text corpus before the perplexity computation takes
place. By default, the same functions used during model building are
employed, c.f. <a href='kgram_freqs.html'>kgram_freqs</a> and <a href='language_model.html'>language_model</a>.</p>
<p>A note of caution is in order. Perplexity is not defined for all language
models available in <a href='kgrams-package.html'>kgrams</a>. For instance, smoother
<code>"sbo"</code> (i.e. Stupid Backoff (Brants et al. 2007)
)
does not produce normalized probabilities,
and this is signaled by a warning (shown once per session) if the user
attempts to compute the perplexity for such a model.
In these cases, when possible, perplexity computations are performed
anyway case, as the results might still be useful (e.g. to tune the model's
parameters), even if their probabilistic interpretation does no longer hold.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Brants T, Popat AC, Xu P, Och FJ, Dean J (2007).
&#8220;Large Language Models in Machine Translation.&#8221;
In <em>Proceedings of the 2007 Joint Conference on Empirical Methods in Natural Language Processing and Computational Natural Language Learning (EMNLP-CoNLL)</em>, 858--867.
<a href='https://www.aclweb.org/anthology/D07-1090'>https://www.aclweb.org/anthology/D07-1090</a>.<br /><br /> Chen SF, Goodman J (1999).
&#8220;An empirical study of smoothing techniques for language modeling.&#8221;
<em>Computer Speech \&amp; Language</em>, <b>13</b>(4), 359--394.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Valerio Gherardi</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Train 4-, 6-, and 8-gram models on Shakespeare's "Much Ado About Nothing",</span>
<span class='co'># compute their perplexities on the training and test corpora.</span>
<span class='co'># We use Shakespeare's "A Midsummer Night's Dream" as test. </span>
<span class='va'>train</span> <span class='op'>&lt;-</span> <span class='va'>much_ado</span>
<span class='va'>test</span> <span class='op'>&lt;-</span> <span class='va'>midsummer</span>

<span class='va'>tknz</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>text</span><span class='op'>)</span> <span class='fu'><a href='tknz_sent.html'>tknz_sent</a></span><span class='op'>(</span><span class='va'>text</span>, keep_first <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>f</span> <span class='op'>&lt;-</span> <span class='fu'><a href='kgram_freqs.html'>kgram_freqs</a></span><span class='op'>(</span><span class='va'>train</span>, <span class='fl'>8</span>, .tknz_sent <span class='op'>=</span> <span class='va'>tknz</span><span class='op'>)</span>
<span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fu'><a href='language_model.html'>language_model</a></span><span class='op'>(</span><span class='va'>f</span>, <span class='st'>"kn"</span>, D <span class='op'>=</span> <span class='fl'>0.75</span><span class='op'>)</span>

<span class='va'>FUN</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>N</span><span class='op'>)</span> <span class='op'>{</span>
        <span class='fu'><a href='parameters.html'>param</a></span><span class='op'>(</span><span class='va'>m</span>, <span class='st'>"N"</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='va'>N</span>
        <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>train <span class='op'>=</span> <span class='fu'>perplexity</span><span class='op'>(</span><span class='va'>train</span>, <span class='va'>m</span><span class='op'>)</span>, test <span class='op'>=</span> <span class='fu'>perplexity</span><span class='op'>(</span><span class='va'>test</span>, <span class='va'>m</span><span class='op'>)</span><span class='op'>)</span>
        <span class='op'>}</span>

<span class='co'># Demonstrate overfitting of the higher order models</span>
<span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>sapply</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"N = 4"</span> <span class='op'>=</span> <span class='fl'>4</span>, <span class='st'>"N = 6"</span> <span class='op'>=</span> <span class='fl'>6</span>, <span class='st'>"N = 8"</span> <span class='op'>=</span> <span class='fl'>8</span><span class='op'>)</span>, <span class='va'>FUN</span><span class='op'>)</span>
</div><div class='output co'>#&gt;            N = 4      N = 6      N = 8
#&gt; train   3.838982   2.693763   2.347808
#&gt; test  258.941391 269.678011 281.434670</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Valerio Gherardi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


